#!/usr/bin/env php
<?php
error_reporting(-1);

require __DIR__ . '/../vendor/autoload.php';

use Icecave\Chastity\Driver\Redis\RedisDriver;
use Icecave\Chastity\LockFactory;
use Icecave\Druid\UuidVersion4Generator;
use Predis\Client;

$factory = new LockFactory(
    new RedisDriver(
        new Client(),
        new UuidVersion4Generator()
    )
);

echo 'Waiting for lock ...' . PHP_EOL;
$lock = $factory->acquire('foo', 10, 0);
echo 'Lock acquired, sleeping ...' . PHP_EOL;
sleep(5);
echo 'Done!' . PHP_EOL;

